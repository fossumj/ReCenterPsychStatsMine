# Mixed Design ANOVA {#Mixed}

 [Screencasted Lecture Link](https://spu.hosted.panopto.com/Panopto/Pages/Viewer.aspx?pid=b08debbb-948e-4f25-923a-ad8c01037e05) 
 
```{r include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#keeps out the hashtags in the knits
knitr::opts_chunk$set(comment = NA) 
#eliminates scientific notation
options(scipen=999)
```

The focus of this lecture is mixed design ANOVA. That is, we are conducting a two-way ANOVA where one of the factors is repeated measures and one of the factors is between groups. The mixed design ANOVA is often associated with the random clinical trial (RCT) where the researcher hopes for a significant interaction effect. Specifically, the researcher hopes that the individuals who were randomly assigned to the treatment condition improve from pre-test to post-test and maintain (or continue to improve) after post-test, while the people assigned to the no-treatment control are not statistically significantly different from treatment group at pre-test, and do not improve over time.

## Navigating this Lesson

There is just over one hour of lecture. If you work through the materials with me it would be plan for an additional two hours.

While the majority of R objects and data you will need are created within the R script that sources the chapter, occasionally there are some that cannot be created from within the R framework. Additionally, sometimes links fail. All original materials are provided at the [Github site](https://github.com/lhbikos/ReCenterPsychStats) that hosts the book. More detailed guidelines for ways to access all these materials are provided in the OER's [introduction](#ReCintro)

### Learning Objectives

Learning objectives from this lecture include the following:

* Evaluate the suitability of a research design/question and dataset for conducting a mixed design ANOVA; identify alternatives if the data is not suitable.
* Test the assumptions for mixed design ANOVA.
* Conduct a mixed design ANOVA (omnibus and follow-up) in R.
* Interpret output from the mixed design ANOVA (and follow-up). 
* Prepare an APA style results section of the mixed design ANOVA output.
* Conduct a power analysis for mixed design ANOVA.

### Planning for Practice

In each of these lessons I provide suggestions for practice that allow you to select from problems that vary in degree of difficulty. The least complex is to change the random seed and rework the problem demonstrated in the lesson. The results *should* map onto the ones obtained in the lecture. 

The second option comes from the research vignette. The Murrar and Brauer [-@murrar_entertainment-education_2018] article has three variables (attitudes toward Arabs, attitudes toward Whites, and a difference score) which are suitable for mixed design ANOVAs. I will demonstrate a mixed design ANOVA with the difference score. I'll leave the other two variables for opportunities for practice.

As a third option, you are welcome to use data to which you have access and is suitable for two-way ANOVA. IIn either case the practice options suggest that you:

* test the statistical assumptions
* conduct a mixed design ANOVA, including
  - omnibus test and effect size
  - report main and interaction effects
  - conduct follow-up testing of simple main effects
* write a results section to include a figure and tables

### Readings & Resources

In preparing this chapter, I drew heavily from the following resource(s). Other resources are cited (when possible, linked) in the text with complete citations in the reference list.

* Repeated Measures ANOVA in R: The Ultimate Guide. (n.d.). Datanovia. Retrieved October 19, 2020, from https://www.datanovia.com/en/lessons/repeated-measures-anova-in-r/
  - This website is an excellent guide fofr both one-way repeated measures and mixed design ANOVA. It is a great resource for both the conceptual and procedural. This is the guide I have used for the basis of the lecture. Working through their example would be provide an additional, excellent, opportunity for practice.
* Murrar, S., & Brauer, M. (2018). Entertainment-education effectively reduces prejudice. *Group Processes & Intergroup Relations, 21*(7), 1053–1077. https://doi.org/10.1177/1368430216682350
  - This article is the source of our research vignette. Our vignette is simulated from the first of their two experiments. The authors did not conduct mixed design ANOVA. Instead, they ran independent-samples *t* tests to test the differences between the sitcom conditions for each of the three waves. This is comparable to conducting the simple-main effect analysis of condition within wave subsequent to a significant interaction. 
  - Full-text of the article is available at the [authors' ResearchGate](https://www.researchgate.net/publication/312177602_Entertainment-education_effectively_reduces_prejudice).

### Packages

The packages used in this lesson are embedded in this code. When the hashtags are removed, the script below will (a) check to see if the following packages are installed on your computer and, if not (b) install them.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
#will install the package if not already installed
#if(!require(knitr)){install.packages("knitr")}
#if(!require(tidyverse)){install.packages("tidyverse")}
#if(!require(psych)){install.packages("psych")}
#if(!require(ggpubr)){install.packages("ggpubr")}
#if(!require(rstatix)){install.packages("rstatix")}
#if(!require(MASS)){install.packages("MASS")}
#if(!require(effectsize)){install.packages("effectsize")}
#if(!require(WebPower)){install.packages("WebPower")}
```

## Introducing Mixed Design ANOVA

Mixed design ANOVA is characterized by the following:

* at least two independent variables. 
* Termed “mixed” because 
  - one is a between-subjects factor, and 
  - one is a repeated-measures (i.e., within-subjects) factor.
* In essence, we are simultaneously conducting 
  - a one-way independent ANOVA and a 
  - a one-way repeated-measures ANOVA.
 
Especially when there is a significant interaction there can be numerous ways to follow up. We will work one set of analyses: simple main effects (condition within wave; wave within condition) and, when needed, conduct posthoc pairwise comparisons as follow-up. Other good options include identifying a priori contrasts and conducting polynomials (not demonstrated in this lecture).

### Workflow for the Mixed Design ANOVA

![Image of a workflow for mixed design ANOVA](images/mixed/mx_workflow.jpg)

The steps in working the mixed design generally include,

1. Exploring the data/evaluating the assumptions
2. Evaluating the omnibus test
3. Follow-up to the omnibus
   - if significant interaction effect: simple main effects and further follow-up to those
   - if significant main effect (but no significant interaction effect), identify source of significance in the main effect
   - if no significance, stop
4. Write it up with tables, figure(s)

Assumptions for the mixed design ANOVA include the following:

* The dependent variable should be continuous with no significant outliers in any cell of the design
  - Check by visualizing the data using box plots and by using the *rstatix::identify_outliers()* function
* The DV should be approximately normally distributed in each cell of the design
  - Check with Shapiro-Wilk normality test *rstatix::shapiro_test()* function and with visual inspection by creating Q-Q plots. The *ggpubr::ggqqplot()* function is a great tool.
* The variances of the differences between groups should be equal. This is termed the **sphericity assumption.** This can be checked with Mauchly's test of sphericity, which is reported automatically in the *rstatix::anova_test()* output.

The best way to address violations of these assumptions is not always clear. Possible solutions include:

* For 2- and 3- way ANOVAs, violations of the normality assumption might be addressed by removing extreme outliers or considering transformations of the data. Transformations, though, introduce their own compexities regarding interpretation. Kline's text [-@kline_principles_2016] provides excellent coverage of options.
* A robust ANOVA option is available in the *WRS2* package
* If there are three or more waves/conditions and the sample is large, it may be possible to run a multi-level, model.
* In the absence of alternatives, it may be necessary to run the mixed design with the violated assumptions, but report them.
* ....and more. Internet searches continue to offer new approaches and alternatives.

## Research Vignette

This lesson's research vignette is from Murrar and Brauer's [-@murrar_entertainment-education_2018] article that describes the results of two studies that evaluated interventions designed to reduce prejudice against Arabs/Muslims. We are working only a portion of the first study reported in the article. Participants (*N* = 193), all who were White, were randomly assigned to one of two conditions where they watched six episodes of the sitcom [*Friends*](http://www.friends-tv.org/) or [*Little Mosque on the Prairie*](https://en.wikipedia.org/wiki/Little_Mosque_on_the_Prairie). The sitcoms and specific episodes were selected after significant pilot testing. The selection was based on the tension selecting stimuli that were as similar as possible, yet the intervention-oriented sitcom needed to invoke psychological processes known to reduce prejudice. The authors felt that both series had characters that were likable and relatable and were engaged in regular activities of daily living. The Friends series featured characters who were predominantly White, cis-gendered, and straight. The Little Mosque series portrayed the experience of Western Muslims and Arabs as they lived in a small Canadian town. This study involved assessment across three waves: baseline (before watching the assigned episodes), post1 (immediately after watching the episodes), and post2 (completed 4-6 weeks after watching the episodes).

The study used *feelings and liking thermometers*, rating their feelings and liking toward 10 different groups of people on a 0 to 100 sliding scale (with higher scores reflecting greater liking and positive feelings). For the purpose of this analysis, the ratings of attitudes toward White people and attitudes toward Arabs/Muslims were used. A third metric was introduced by subtracting the attitudes towards Arabs/Muslims from the attitudes toward Whites. Higher scores indicated more positive attitudes toward Whites where as low scores indicated no difference in attitudes. To recap, there were three potential dependent variables, all continuously scaled:

* *AttWhite*: attitudes toward White people; higher scores reflect greater liking
* *AttArab*: attitudes toward Arab people; higher scores reflect greater liking
* *Diff*: the difference between AttWhite and AttArab; higher scores reflect a greater liking for White people

With random assignment, nearly equal cell sizes, a condition with two levels (Friends, Little Mosque), and three waves (baseline, post1, post2), this is perfect for mixed design ANOVA.

![Image of the design for the Murrar and Brauer (2018) study](images/mixed/Murrar_design.jpg)

### Data Simulation

Below is the code I have used to simulate the data. The simulation includes two dependent variables (AttWhite, AttArab), Wave (baseline, post1, post2), and COND (condition; Friends, Little_Mosque). There is also a caseID (repeated three times across the three waves) and rowID (giving each observation within each case an ID). This creates the long-file, where each person has 3 rows of data representing baseline, post1, and post2. You can use this simulation for two of the three practice suggestions.

```{r message=FALSE, library=FALSE, tidy=TRUE, tidy.opts=list(width.cutoff=70)}
library(tidyverse)
#change this to any different number (and rerun the simulation) to rework the chapter problem
set.seed(210813)
AttWhite<-round(c(rnorm(98,mean=76.79,sd=18.55),rnorm(95,mean=75.37,sd=18.99),rnorm(98, mean=77.47, sd=18.95), rnorm(95, mean=75.81, sd=19.29), rnorm(98, mean=77.79, sd=17.25), rnorm(95, mean=75.89, sd=19.44)),3) #sample size, M and SD for each cell; this will put it in a long file
#set upper bound for variable
AttWhite[AttWhite>100]<-100 
#set lower bound for variable
AttWhite[AttWhite<0]<-0 
AttArab<-round(c(rnorm(98,mean=64.11,sd=20.97),rnorm(95,mean=64.37,sd=20.03),rnorm(98, mean=64.16, sd=21.64), rnorm(95, mean=70.52, sd=18.55), rnorm(98, mean=65.29, sd=19.76), rnorm(95, mean=70.30, sd=17.98)),3)
#set upper bound for variable
AttArab[AttArab>100]<-100 
#set lower bound for variable
AttArab[AttArab<0]<-0 
rowID <- factor(seq(1,579))
caseID <- rep((1:193),3)
Wave <- c(rep("Baseline",193), rep("Post1", 193), rep ("Post2", 193))
COND <- c(rep("Friends", 98), rep("LittleMosque", 95), rep("Friends", 98), rep("LittleMosque", 95), rep("Friends", 98), rep("LittleMosque", 95))
#groups the 3 variables into a single df:  ID#, DV, condition
Murrar_df<- data.frame(rowID, caseID, Wave, COND, AttArab, AttWhite) 
```

Let's check the structure. We want 

* rowID and caseID to be unordered factors
* Wave and COND to be ordered factors
* AttArab and AttWhite to be numerical

```{r}
str(Murrar_df)
```
The script below changes

* caseID from integer to factor
* Wave and COND from factor to ordered factors
  - It makes sense to order Friends and LittleMosque, since we believe that LittleMosque contains prejudice-reducing properties
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
#make caseID a factor
Murrar_df[,'caseID'] <- as.factor(Murrar_df[,'caseID'])
#make Wave an ordered factor
Murrar_df$Wave <- factor(Murrar_df$Wave, levels = c("Baseline", "Post1", "Post2"))
#make COND an ordered factor
Murrar_df$COND <- factor(Murrar_df$COND, levels = c("Friends", "LittleMosque"))
```

Let's check the structure again.
```{r}
str(Murrar_df)
```

A key dependent variable in the Murrar and Brauer [@murrar_entertainment-education_2018] article is *attitude difference.* Specifically, the attitudes toward Arabs score was subtracted from the attitudes toward Whites scores. Higher attitude difference indicate a greater preference for Whites. Let's create that variable, here.

```{r}
Murrar_df$Diff <- Murrar_df$AttWhite - Murrar_df$AttArab
```

If you want to export this data as a file to your computer, remove the hashtags to save it (and re-import it) as a .csv ("Excel lite") or .rds (R object) file. This is not a necessary step.

The code for the .rds file will retain the formatting of the variables, but is not easy to view outside of R. This is what I would do.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
#to save the df as an .rds (think "R object") file on your computer; 
#it should save in the same file as the .rmd file you are working with
#saveRDS(Murrar_df, "Murrar_RDS.rds")
#bring back the simulated dat from an .rds file
#Murrar_df <- readRDS("Murrar_RDS.rds")
```

The code for .csv will likely lose the formatting (i.e., stripping Wave and COND of their ordered factors), but it is easy to view in Excel.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
#write the simulated data as a .csv
#write.table(Murrar_df, file="DiffCSV.csv", sep=",", col.names=TRUE, row.names=FALSE)
#bring back the simulated dat from a .csv file
#Murrar_df <- read.csv ("DiffCSV.csv", header = TRUE)
```


### Quick peek at the data
Let's first examine the descriptive statistics (e.g., means of the variable, Negative) by group. We can use the *describeBy()* function from the *psych* package.

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
Diff.descripts <- psych::describeBy(Diff ~ COND + Wave, mat = TRUE, data = Murrar_df, digits = 3) #digits allows us to round the output
Diff.descripts
#Note. Recently my students and I have been having intermittent struggles with the describeBy function in the psych package. We have noticed that it is problematic when using .rds files and when using data directly imported from Qualtrics. If you are having similar difficulties, try uploading the .csv file and making the appropriate formatting changes.
```
First we inspect the means. We see that the baseline scores for the Friends and Little Mosque conditions are similar. However, the post1 and post2 difference scores (i.e., difference in attitudes toward White and Arab individuals, where higher scores indicate more favorable ratings of White individuals) are higher in the Friends condition than in the Little Mosque condition.


The *write.table()* function can be a helpful way to export output to .csv files so that you can manipulate it into tables. 

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
write.table(Diff.descripts, file="DiffDescripts.csv", sep=",", col.names=TRUE, row.names=FALSE)
```

At this stage, it would be useful to plot our data. Figures can assist in the conceptualization of the analysis. 

```{r message = FALSE, warning = FALSE, tidy=TRUE, tidy.opts=list(width.cutoff=70)}
ggpubr::ggboxplot(Murrar_df, x = "Wave", y = "Diff", color = "COND",xlab = "Study Wave", ylab = "Difference in Attitudes toward Arab and White People", add = "jitter", title = "Figure 10.1 Difference Scores: Condition within Wave")
```

Narrating results is sometimes made easier if variables are switched. There is usually not a right or wrong answer. Here is another view, switching the Rater and Photo predictors.

```{r message = FALSE, warning = FALSE, tidy=TRUE, tidy.opts=list(width.cutoff=70)}
ggpubr::ggboxplot(Murrar_df, x = "COND", y = "Diff", color = "Wave", xlab = "Study Condition",
             ylab = "Difference in Attitudes toward Arab and White People", add = "jitter", title = "Figure 10.3 Difference Scores: Wave within Condition")
```

Yet another option plots the raw data as bubbles, the means as lines, and denotes differences in the moderator with color.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70), warning = FALSE, message = FALSE}
ggpubr::ggline(Murrar_df, x = "Wave", y = "Diff", color = "COND", xlab = "Study Wave",
             ylab = "Difference in Attitudes toward Arab and White People", add = c("mean_se", "dotplot"), title = "Figure 10.3 Lineplots: Condition within Wave")

#add this for a different color palette:  palette = c("#00AFBB", "#E7B800")
```
We can reverse this to see if it assists with our conceptualization.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70), warning = FALSE, message = FALSE}
ggpubr::ggline(Murrar_df, x = "COND", y = "Diff", color = "Wave", xlab = "Study Condition",
             ylab = "Difference in Attitudes toward Arab and White People", add = c("mean_se", "dotplot"), title = "Figure 8.4 Lineplots: Wave within Condition")
```



## Working the Mixed Design ANOVA with R packages

### Exploring data and testing assumptions

We begin the 2x3 mixed design ANOVA with a preliminary exploration of the data and testing of the assumptions. Here's where we are on the workflow:

![Image of the workflow showing that we are on the "Evaluating assumptions" portion](images/mixed/mx_Assumptions.jpg)

The are several critical assumptions in factorial ANOVA:

* Cases represent random samples from the populations 
  - This is an issue of research design
  - Although we see ANOVA used (often incorrectly) in other settings, ANOVA was really designed for the random clinical trial (RCT).
* The DV is continuously scaled (i.e., assessed on an interval or ratio scale); this is a matter of research design.
* The DV is normally distributed for each of the populations
  - that is, data for each cell (representing the combinations of each factor) is normally distributed.
* Population variances of the DV are the same for all cells (i.e., homogeneity of variance assumption)
  - When cell sizes are not equal, ANOVA not robust to this violation and we cannot trust *F* ratio.
* If the repeated measures factor has three or more levels the population variance of difference scores computed between any two levels of a within-subjects factor is the same value regardless of which two levels are chosen; termed the **sphericity assumption**. This assumption is
  - akin to compound symmetry (both variances across conditions are equal).
  - akin to the homogeneity of variance assumption in between-group designs. 
  - sometimes called the homogeneity-of-variance-of-differences assumption. 
  - statistically evaluated with *Mauchly's test.* If Mauchly's *p* < .05, there are statistically significant differences. The *anova_test()* function in the *rstatix* package reports Mauchly's and two alternatives to the traditional *F* that correct the values by the degree to which the sphericity assumption is violated. 
* The covariance matrix of the DV is the same for all levels of the between-subjects factors (i.e., homogeneity of covariance matrix).


#### Is the dependent variable normally distributed?

##### Are skew and kurtosis levels concerning? 

Our analysis will use the difference score (Diff) as the dependent variable. Let's inspect values of skew and kurtosis for this variable in its combinations of wave and condition.

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
psych::describeBy(Diff ~ Wave + COND, data = Murrar_df, mat=TRUE)
#Note. Recently my students and I have been having intermittent struggles with the describeBy function in the psych package. We have noticed that it is problematic when using .rds files and when using data directly imported from Qualtrics. If you are having similar difficulties, try uploading the .csv file and making the appropriate formatting changes.
```

Our values of skew and kurtosis are well within the limits [@kline_principles_2016] of a normal distribution.

* skew: < |3|; the highest skew value in our data is 0.32
* kurtosis: < |10|; the highest kurtosis value in our data is .55

##### Are the model residuals normally distributed?

We can formally investigate the normality assumption with the Shapiro-Wilk test. In the case of multiple factors (such as is the case in mixed design ANOVA), the assumption requires a normal distribution in each combination of these levels (e.g., difference scores at baseline for participants in the Friends condition). In this lesson's 3 x 2 ANOVA, there are six such combinations. A cell-level analysis (i.e., testing for normal distributions within each combination of factor levels) has been demonstrated in [one-way ANOVA](#oneway) and independent [t-test](#tIndSample) lessons. To the degree that there are many factorial combinations (and therefore, cells), this approach becomes unwieldy to calculate, interpret, and report. Further, the cell-level analysis of normality is only appropriate when there are a low number of levels/groupings and there are many data points per group. As designs increase in complexity, researchers turn to the model-based option for assessing normality. 

To do this, we first create an object that tests our research model. Because the model-based approach to calculating the Shapiro-Wilk test of normality requires an object created by the *aov()* function from base R, I will quickly run this. For the moment, we will only peek at the ANOVA results to make sure it ran, but will save the interpretation until later. 

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
Mixed_diff<-aov(Diff~COND*Wave, Murrar_df)
summary(Mixed_diff)
```
From this object we can extract the residuals.

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
#creates object of residuals
resid_Diff<- residuals(Mixed_diff) 
```

We can visually inspect the distribution of the residuals with a couple of plots.

```{r}
hist(resid_Diff)
```
So far so good -- our distribution of *residuals* (i.e., what is leftover after the model is applied) resembles a normal distribution.

The Q-Q plot provides another view. The dots represent the residuals. When they are relatively close to the line they not only suggest good fit of the model, but we know they are small and evenly distributed around zero (i.e., normally distributed). 

```{r  tidy=TRUE, tidy.opts=list(width.cutoff=70)}
qqnorm(resid_Diff)
```

Finally, we can formally evaluate whether or not the distribution of residuals is statistically significantly different from a normal distribution with a Shapiro test. We want the associated *p* value to be greater than 0.05.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
shapiro.test(resid_Diff)
```
The non-significant *p* value indicates that the distribution of our model residuals are not statistically significantly different from a normal distribution ($W = 0.997, p = 0.936$).
 

##### Is there evidence of outliers?

The boxplot is one common way for identifying outliers. The boxplot uses the median and the lower (25th percentile) and upper (75th percentile) quartiles. The difference bewteen Q3 and Q1 is the *interquartile range* (IQR). Let's revisit one of our boxplots to see if there are any dots above the whiskers.

```{r message = FALSE, warning = FALSE, tidy=TRUE, tidy.opts=list(width.cutoff=70)}
ggpubr::ggboxplot(Murrar_df, x = "COND", y = "Diff", color = "Wave", xlab = "Study Condition",
             ylab = "Difference in Attitudes toward Arab and White People", add = "jitter", title = "Figure 10.3 Difference Scores: Wave within Condition")
```

The distributions look relatively normal with the mean well-centered. Given that we simulated the data from means and standard deviations, this is somewhat expected. 
Outliers are generally identified when values fall outside these lower and upper boundaries. In the short formulas below, IQR is the *interquartile range* (i.e., the middle 50%, the distance of the box):

* Q1 - 1.5xIQR
* Q3 + 1.5xIQR

Extreme values occur when values fall outside these boundaries:

* Q1 - 3xIQR
* Q3 + 3xIQR

Using the *rstatix::identify_outliers* function we can identifier outliers, doubly grouped by our predictor variables.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
Murrar_df %>%
  group_by(Wave, COND) %>%
  rstatix::identify_outliers(Diff)
```
While we have some outliers (where "is.outlier" = "TRUE"), none are extreme (where "is.outlier" = "FALSE"). We'll keep these in mind as we continue to evaluate the data.

If I had extreme outliers, I would individually inspect them. Especially if something looked awry (e.g., erratic responding extreme scores across variables) I might consider deleting them. In this mixed design ANOVA, a case will only be included in the final analysis if all three waves of data are present. Therefore, if we decided to remove case at rowID = 337, we would need to remove all three cases. That is, we would need to remove it by caseID = 144. This would decrease the number of rows/observations by 3.

Let's say that, after very careful consideration, we decided to remove the caseID = 144. We could use *dplyr::filter()* to do so. In this code, the *filter()* function locates all the cases where caseID = 144. The exclamation point that precedes the equal sign indicates that the purpose is to remove the case. 

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
#Murrar_df <- dplyr::filter (Murrar_df, caseID != "144")
```

Once executed, we can see that this case is no longer in the dataframe. Because each person had three observations, this reduces the number of observations by 3. Although I demonstrated this in the accompanying lecture, I have hashtagged out the command because I would not delete the case. If you already deleted the case, you can return the hashtag and re-run all the code up to this point.

#### Homogeneity of variance assumption

Because there is a between-subjects variable, we need need to evaluate the homogeneity of variance assumption. As before, we can use the Levene's test with the *rstatix::levene_test()* function. Considering each of the comparisons of condition within wave, there is no instance where we violate the assumption.

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
Murrar_df %>%
  group_by(Wave) %>%
  rstatix::levene_test(Diff ~ COND)
```
Levene's test indicated a violation of this assumption between the Friends and Little Mosque conditions at baseline ($F[1, 191] = 3.973, p = .047$). However, there was no indication of assumption violation at post1 ($F[1, 191] = 0.141, p = .708$), and post2 ($F[1, 191] = 0.107, p = .743$) waves of the design.

#### Assumption of homogeneity of covariance matrices

In this multivariate sample, the Box's M test evaluates if two or more covariance matrices are homogeneous. Like other tests of assumptions, we want a non-significant test result (i.e., where *p* > .05). Box's M has some disavantages. Box's M has low power in small sample sizes and is overly sensitive in large sample sizes. We would unlikely make a decision about our data with Box's M alone. Rather, we consider it along with our dashboard of diagnostic screeners.

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
rstatix::box_m(Murrar_df[, "Diff", drop = FALSE], Murrar_df$COND)
```
Box's M indicated no violation of the homogeneity of covariance matrices assumption ($M = 3.209, p = .073$)

#### APA style writeup of assumptions

At this stage we are ready to draft the portion of the APA style writeup that evaluates the assumptions.

>Mixed design ANOVA has a number of assumptions related to both the within-subjects and between-subjects elements. Data are expected to be normally distributed at each level of design. There was no evidence of skew (all values were at or below the absolute value of 0.32) or kurtosis (all values were below the absolute value of .57; [@kline_principles_2016]). Similarly, results of the Shapiro-Wilk normality test (applied to the residuals from the factorial ANOVA model) suggested that model residuals did not differ significantly from a normal distribution ($W = 0.997, p = 0.936$). Visual inspection of boxplots for each wave of the design, assisted by the *rstatix::identify_outliers()* function (which reports values above Q3 + 1.5xIQR or below Q1 - 1.5xIQR, where IQR is the interquartile range) indicated some outliers, but none at the extreme level. Because of the between-subjects aspect of the design, the homogeneity of variance assumption was evaluated. Levene's test indicated a violation of this assumption between the Friends and Little Mosque conditions at baseline ($F[1, 191] = 3.973, p = .047$). However, there was no indication of assumption violation at post1 ($F[1, 191] = 0.141, p = .708$), and post2 ($F[1, 191] = 0.107, p = .743$) waves of the design. Further, Box's M-test (*M* = 3.209, *p* = .073) indicated no violation of the homogeneity of covariance matrices. *LATER WE WILL ADD INFORMATION ABOUT THE SPHERICITY ASSUMPTION.*


### Omnibus ANOVA

Having evaluated the assumptions (excepting sphericity) we are ready to move to the evaluation of the omnibus ANOVA. This next step produces both the omnibus test as well as testing the sphericity assumption. Conceptually, evaluating the sphericity assumption precedes the omnibus; procedurally these are evaluated simultaneously. The figure also reflects that decisions related to follow-up are dependent upon the significance of the main and omnibus effects.

![Image of the workflow showing that we at the "Compute the Omnibus ANOVA" step](images/mixed/mx_omnibus.jpg)

The *rstatix* package is a wrapper for the *car* package. Authors of *wrappers* attempt to streamline a more complex program to simplify the input needed and maximize the output produced for the typical use-cases.

If we are ever confused about a function, we can place a question mark in front of it. It will summons information and, if the package is in our library, let us know to which package it belongs and open the instructions that are embedded in R/R Studio.

```{r }
#?anova_test
```

In the code below the identification of the data, DV, between, and within variables are likely to be intuitive. The within-subjects identifier (*wid*) is the person-level ID that assists the statistic in controlling for the dependency introduced by the repeated-measures factor.

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
#Murrar_df is our df, Diff is our df, wid is the caseID
#between is the between-subjects variable, within is the within subjects variable
Diff_2way <- rstatix::anova_test(
  data = Murrar_df, dv = Diff, wid = caseID, 
  between = COND, within = Wave, detailed = TRUE
  )
Diff_2way
```

#### Checking the sphericity assumption

We continue our evaluation of statistical assumptions by examining the Mauchly's test for sphericity -- which is reported with the results of the omnibus ANVOA. The sphericity assumption becomes important when there are three or more levels in the repeated measures factor. The assumption requires that the variance of difference scores computed between any two levels of a within-subjects factor is the same value regardless of which two levels are chosen. As with so many of our statistical tests of assumptions, we want the *p* value to be > .05.

Mauchly's test (in the middle of the output) reports the result. Because our Wave variable has three levels and appears in the main and interaction effects. The results are identical and we didn't violate the sphericity assumption. 

* main effect for Wave: $W = .99, p = .369$
* interaction effect for COND:Wave: $W = .99, p = .369$

We will be able to add this statement to our assumptions write-up: 

>Mauchly's test indicated no violation of the sphericity assumption for the main ($W = .99, p = .369$) and interaction ($W = .99, p = .369$) effects. 

If the *p* vaue associated with Mauchly's test had been less than .05, we could have used one of the two options (Greenhouse Geyser/GGe or Huynh-Feldt/HFe). In each of these an epsilon value provides an adjustment to the degrees of freedom used in the estimation of the *p* value. 

When there are concerns about sphericity violations, there is also a multivariate approach that does not require the assumption of sphericity. The *rstatix* package does include this analysis. There is also an option to use a multivariate approach when ANOVA designs include a repeated measures factor. In the [appendix](#RMmultiv), I included an example of the multivariate approach with a one-way repeated measures design using with the *car* package.

#### Interpreting the omnibus results

We are interested in the output reported in rows 2, 3, 4. These include the:

* main effect for condition: $F(1, 191) = 13.149, p < .001, \eta^{2} = 0.023$
* main effect for wave: $F(2, 382) = 0.273, p = .761, \eta^{2} = 0.001$
* condition:wave interaction effect: $F(2, 382) = 5.008, p = 0.007, \eta^{2} = 0.017$

>Results of the omnibus ANOVA indicated a significant main effect for condition ($F[1, 191] = 13.149, p < .001, \eta^{2} = 0.023$), a non-significant main effect for wave ($F[2, 382] = 0.273, p = .761, \eta^{2} = 0.001$), and a significant interaction effect ($F[2, 382] = 5.008, p = 0.007, \eta^{2} = 0.017$). 

In the output, the column labeled "ges" provides the value for the effect size, $\eta^{2}$. Recall that *eta-squared* is one of the most commonly used measures of effect. It refers to the proportion of variability in the dependent variable/outcome that can be explained in terms of the independent variable/predictor. Conventionally, values of .01, .06, and .14 are considered to be small, medium, and large effect sizes, respectively. 

You may see different values (.02, .13, .26) offered as small, medium, and large -- these values are used when multiple regression is used. A useful summary of effect sizes, guide to interpreting their magnitudes, and common usage can be found [here](https://imaging.mrc-cbu.cam.ac.uk/statswiki/FAQ/effectSize) [@watson_rules_2020].

With a significant interaction effect, we would focus on interpreting one or both of the simple main effects. Let's first look at the simple main effect of condition within wave option.

### Follow-up to Omnibus Tests

#### Planning for the management of Type I error

Controlling for Type I error can depend, in part, on the design of the follow-up tests that are planned, and the number of pairwise comparisons that follow.

In the first option, the examination of the simple main effect of condition within wave results in only three pairwise comparisons. In this case, I will use the traditional Bonferroni. Why? Because there are only three post omnibus analyses, its more restrictive control is less likely to be problematic.

In the second option, the examination of the simple main effect of wave within condition results in the potential comparison of nine pairwise comparisons. If we used a traditional Bonferroni and divided .05/9, the *p* value for each comparison would need to be less than 0.008. Most would agree that this is too restrictive.

```{r}
.05/6
```

The Holm's sequential Bonferroni [@green_using_2017] offers a middle-of-the-road approach (not as strict as .05/6 with the traditional Bonferroni; not as lenient as "none") to managing Type I error. 

If we were to hand-calculate the Holms, we would rank order the *p* values associated with the 6 comparisons in order from lowest (e.g., 0.000001448891) to highest (e.g., 1.000). The first *p* value is evaluated with the most strict criterion (.05/6; the traditional Bonferonni approach). Then, each successive comparison calculates the *p* value by using the number of *remaining* comparisons as the denominator (e.g., .05/5, .05/4, .05/3). As the *p* values increase and the alpha levels relax, there will be a cut-point where remaining comparisons are not statistically significant. Luckily, most R packages offer the Holm's sequential Bonferroni as an option. The algorithm in the package rearranges the mathematical formula and produces a *p* value that we can interpret according to the traditional values of $p < .05, p < .01$ and $p < .001$. I will demonstrate use of Holm's in the examination of the simple main effect of ethnicity of rater within photo stimulus.

### Simple main effect of condition within wave

The figure reflects our path in the workflow. In the presence of a significant interaction effect we could choose from a variety of follow-up tests. 

![Image of the workflow showing that we are at the "Simple Main Effects for Factor A within all levels of Factor B" step](images/mixed/mx_SimpleMainA.jpg)

If we take this option we follow up with three one-way ANOVAs. When we look at condition within wave, our ANOVAs will look like this:

* comparison of Friends and Little Mosque within the baseline wave
* comparison of Friends and Little Mosque within the post1 wave
* comparison of Friends and Little Mosque within the post2 wave

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
#crate an object to hold the output
#the group_by function is what results in three, one-way ANOVAs for each of the waves, separately
#the between = Cond means that each level of cond will be compared
#method - "bonferroni" gets us both the standard and adjusted p values
SimpleWave <- Murrar_df %>% 
  group_by(Wave) %>% 
  rstatix::anova_test(dv = Diff, wid = caseID, between = COND) %>% 
  rstatix::get_anova_table() %>%
  rstatix::adjust_pvalue(method = "bonferroni") 
SimpleWave
```
In prior lectures we have adjusted the *p* value against which we compare the resulting *p* value. When we specify "bonferroni" on the *adjust_pvalue()* command, the algorithm adjusts the reported *p* value for us. We can see the unadjusted *p* value in the "p p<.05" column and the Bonferroni adjustment in the "p.adj" column.

I think that it will be easiest for us to interpret this simple main effect as the traditional *p* < .05 and then apply the restrictions to the alpha at the next level of analysis. In this particular instance, we would have statistically significant differences somewhere between the Friends and Little Mosque conditions for both the Post (*p* = .027) and Post2 (*p* = .010) waves. 

F strings:

* Pre: $F(1, 191) = 0.012, p = .914, \eta^{2} = 0.000$ (the effect size is zero)
* Post: $F(1, 191) = 17.497, p < .001, \eta^{2} = 0.084$ (a moderate effect size)
* Post2: $F(1, 191) = 5.994, p = .015, \eta^{2} = 0.030$ (a small effect size)

Recall, interpretation for the eta-squared are .01 ~ small, .06 ~ medium, and >.14 ~ large

Because there are only two levels (Friends, Little Mosque) within each wave (baseline, post1, post2), this simple effects analysis is complete with the three pairwise comparisons. 

As always, we have several choices about how to manage Type I error. In a circumstance when the analysis of simple main effects (condition within wave) includes only three pairwise comparisons, we can use the LSD method [@green_using_2014]. This means that we can we can leave the alpha at 0.05. If we were to use a traditional Bonferroni, we would use $\alpha$ = .017 (.05/3). Although the more restrictive Bonferroni criteria comes close, in both cases we would still have one non-significant(baseline) and two significant (post1, post2) simple main effects. 
```{r }
.05/3
```

If we were to write up this result:

>We followed the significant interaction effect with an evaluation of simple main effects of condition within wave. Because there were only three comparisons following the omnibus evaluation, we used the LSD method to control for Type I error and left the alpha at .05 [@green_using_2014]. There was a non-statistically significant difference between conditions at baseline: *F* (1, 191) = 0.012, *p* = .914, $\eta^{2}$ = 0.000. However other were statistically significant differences at post1 (*F* [1, 191] = 17.497, *p* < .001, $\eta^{2}$ = 0.084) and post2 (*F*[1, 191] = 5.994, *p* = .015, $\eta^{2}$ = 0.030). We note that the effect size at post1 approached a moderate size; the effect size at post2 was small.

Because we used the *rstatix* functions, we can easily integrate them into our *ggpubr::ggboxplot()*. Let's first re-run the version of the boxplot where "Wave" is on the x-axis (and, is therefore our grouping variable). Because I want the data to be as true-to-scale as possible, I have added the full range of the y axis through the *ylim* argument. In order to update the ggboxplot, we will need to save it as an option. My object name represents the "Wave within Group" simple main effect. 

#I STOPPED HERE

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}

CNDwiWV <- ggpubr::ggboxplot(Murrar_df, x = "Wave", y = "Diff", color = "COND",xlab = "Study Wave", ylab = "Difference in Attitudes toward Arab and White People", add = "jitter", title = "Figure 10.1 Difference Scores: Condition within Wave")

SimpleWave <- SimpleWave %>% rstatix::add_xy_position(x = "Wave")
CNDwiWV + 
  ggpubr::stat_pvalue_manual(pwcWVwiGP, tip.length = 0, hide.ns = TRUE) +
  labs(
    subtitle = rstatix::get_test_label(Diff_2way, detailed = TRUE),
    caption = rstatix::get_pwc_label(SimpleWave)
  )
CNDwiWV
```

### Simple main effect of wave within condition

Alternatively, we could evaluate the simple main effect of wave within condition. The figure reflects our path along the workflow.

![Image of the workflow showing that we at the "Simple Main Effects for Factor B within all levels of Factor A" step](images/mixed/mx_SimplemainB.jpg)

If we conducted this alternative we would start with three one-way ANOVAs and then follow each of those with pairwise comparisons. First, the one-way repeated measures ANOVAs:

* comparison of baseline, post1, and post2 within the Friends condition
* comparison of baseline, post1, and post2 within the Little Mosque condition

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
SimpleCond <- Murrar_df %>%
  group_by(COND) %>%
  rstatix::anova_test(dv = Diff, wid = caseID, within = Wave) %>%
  rstatix::get_anova_table() %>%
  rstatix::adjust_pvalue(method = "none")
SimpleCond
```

Below are the *F* strings for the one-way ANOVAs the followed the omnibus, mixed design, ANOVA:

* Friends: *F* (2, 194) = 1.759, *p* = 0.175, $\eta^{2}$ = 0.012 (effect size indicates no relationship)
* Little Mosque: *F* (2, 188) = 3.392, *p* = 0.036, $\eta^{2}$ = 0.072 (a moderate effect size)

Because each of these one-way ANOVAs has three levels, we need to follow with pairwise comparisons. However, we only need to conduct them for the Little Mosque condition. As you can see we generally work our way down to comparing chunks to each other to find the source(s) of significant differences.

You will notice that we are saving the results of the pairwise comparisons as an object. This is not necessary, however we can use this object in combination with the boxplot we created earlier to embed results of our analysis in the resulting figure.

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
pwcWVwiGP <- Murrar_df %>%
  group_by(COND) %>%
  rstatix::pairwise_t_test(
    Diff ~ Wave, paired = TRUE, detailed = TRUE,
    p.adjust.method = "holm"
    ) #%>%
  #select(-df, -statistic, -p) # Remove details
pwcWVwiGP
```

At this point, we likely need to control for Type I error. Why? We have already conducted two one-way ANOVAs after the omnibus. Now we will conduct three more pairwise comparisons in the Little Mosque condition. I would divide .05/3 and interpret these pairwise comparisons with an alpha of .017.

We find a significant difference between baseline and post1 (*t*[95] = 2.447, *p* = .016), but non-significant differences between baseline and post2 (*t*[95] = 1.621, *p* = .108) and post1 and post2 (*t*[95] = -1.034, *p* = .304)

If we were to write up this result:

>We followed the significant interaction effect with an evaluation of simple main effects of wave within condition. There were non-significant difference within the the Friends condition (*F* [2, 194] = 1.759, *p* = 0.175, $\eta^{2}$ = 0.012). There were significant differences with an effect size indicating a small-to-moderate effect in the Little Mosque condition (*F* [2, 188] = 3.392, *p* = 0.036, $\eta^{2}$ = 0.072). We followed up the significant simple main effect for the Little Mosque condition with pairwiwse comparisons. At this level we controlled for Type I error by dividing alpha (.05) by the number of paired comparisons (3). We found a significant difference between baseline and post1 (*t*[95] = 2.447, *p* = .016), but non-significant differences between baseline and post2 (*t*[95] = 1.621, *p* = .108) and post1 and post2 (*t*[95] = -1.034, *p* = .304).

### If we only had a main effect

When there is an interaction effect, we do not interpret main effects. This is because the solution is more complicated than a main effect could explain. It is important, though, to know how to interpret a main effect. We would do this if we had one or more significant main effects and no interaction effect.

The figure shows our place on the workflow.

![Image of a workflow showing that we at the "Main effects only" step](images/mixed/mx_main.jpg)

If we had not had a significant interaction, but did have a significant main effect for wave, we could have conducted pairwise comparisons for pre, post1, and post2 -- collapsing across condition.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
Murrar_df %>%
  rstatix::pairwise_t_test(
    Diff ~ Wave, paired = TRUE, 
    p.adjust.method = "bonferroni"
  )
```
Ignoring condition (Friends, Little Mosque), we do not see changes across time. This is not surprising since the *F* test for the main effect was also non-significant (*F*[2, 382] = 0.273, *p* = .761, $\eta^{2}$ = 0.0014), 

If we had had a non-significant interaction effect but a significant main effect for condition, there would have been no need for further follow-up. Why? Because there were only two levels the significant main effect already tells us there were statistically significant differences between Friends and Little Mosque (*F*[1, 191] = 13.149, *p* < .001, $\eta^{2}$ = 0.023).


### APA Style Write-up of the Results

Recall that earlier in this lesson we save objects for the boxplots (e.g., CNDwiWV) and the pairwise comparisons (e.g., pwcVWwiGP). The script below use the objects created from omnibus ANOVA and the pairwise comparisons to add results to the figure. Depending on where you are presenting your results, these may be useful. 

This first figure would pair well if you report the simple main effect of condition within wave.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
pwcWVwiGP <- pwcWVwiGP %>% rstatix::add_xy_position(x = "Wave")
CNDwiWV + 
  ggpubr::stat_pvalue_manual(pwcWVwiGP, tip.length = 0, hide.ns = TRUE) +
  labs(
    subtitle = rstatix::get_test_label(Diff_2way, detailed = TRUE),
    caption = rstatix::get_pwc_label(pwcWVwiGP)
  )
```

This second figure would pair well with the results that reported the simple main effect of wave within condition.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
#pwcWVwiGP were my pairwise comparisons for the simple effect
#UE_2way was my omnibus ANOVA object
#WVwiCND was the boxplot before I did the ANOVA
pwcWVwiGP <- pwcWVwiGP %>% rstatix::add_xy_position(x = "Wave") 
WVwiCND +  
  ggpubr::stat_pvalue_manual(pwcWVwiGP, tip.length = 0, hide.ns = TRUE) +
  labs(
    subtitle = rstatix::get_test_label(Diff_2way, detailed = TRUE), 
    caption = rstatix::get_pwc_label(pwcWVwiGP) 
  )
```

#### Results

>We conducted a 2 X 3 mixed design ANOVA to evaluate the combined effects of condition (Friends and Little Mosque) and wave (baseline, post1, post2) on a difference score that compared attitudes toward White and Arab people. 

>Mixed design ANOVA has a number of assumptions related to both the within-subjects and between-subjects elements. Data are expected to be normally distributed at each level of design. There was no evidence of skew (all values were at or below the absolute value of 0.32) or kurtosis (all values were below the absolute value of .57; [@kline_principles_2016]). Similarly, results of the Shapiro-Wilk normality test (applied to the residuals from the factorial ANOVA model) suggested that model residuals did not differ significantly from a normal distribution ($W = 0.997, p = 0.936$). Visual inspection of boxplots for each wave of the design, assisted by the *rstatix::identify_outliers()* function (which reports values above Q3 + 1.5xIQR or below Q1 - 1.5xIQR, where IQR is the interquartile range) indicated some outliers, but none at the extreme level. Because of the between-subjects aspect of the design, the homogeneity of variance assumption was evaluated. Levene's test indicated a violation of this assumption between the Friends and Little Mosque conditions at baseline ($F[1, 191] = 3.973, p = .047$). However, there was no indication of assumption violation at post1 ($F[1, 191] = 0.141, p = .708$), and post2 ($F[1, 191] = 0.107, p = .743$) waves of the design. Further, Box's M-test (*M* = 3.209, *p* = .073) indicated no violation of the homogeneity of covariance matrices. Mauchly's test indicated no violation of the sphericity assumption for the main ($W = .99, p = .369$) and interaction ($W = .99, p = .369$) effects.  

>Results of the omnibus ANOVA indicated a significant main effect for condition ($F[1, 191] = 13.149, p < .001, \eta^{2} = 0.023$), a non-significant main effect for wave ($F[2, 382] = 0.273, p = .761, \eta^{2} = 0.001$), and a significant interaction effect ($F[2, 382] = 5.008, p = 0.007, \eta^{2} = 0.017$). 

>We followed the significant interaction effect with an evaluation of simple main effects of wave within condition. There were non-significant difference within the the Friends condition (*F* [2, 194] = 1.759, *p* = 0.175, $\eta^{2}$ = 0.012). There were significant differences with an effect size indicating a small-to-moderate effect in the Little Mosque condition (*F* [2, 188] = 3.392, *p* = 0.036, $\eta^{2}$ = 0.072). We followed up the significant simple main effect for the Little Mosque condition with pairwiwse comparisons. At this level we controlled for Type I error by dividing alpha (.05) by the number of paired comparisons (3). We found a significant difference between baseline and post1 (*t*[95] = 2.447, *p* = .016), but non-significant differences between baseline and post2 (*t*[95] = 1.621, *p* = .108) and post1 and post2 (*t*[95] = -1.034, *p* = .304).

>As illustrated in Figure 1 difference scores were comparable at baseline. After the intervention, difference scores increased for those in the Friends condition -- indicating more favorable attitudes toward White people. In contrast, those exposed to the Little Mosque condition had difference scores that were lower. Means and standard deviations are reported in Table 1.

The following code can be used to write output to .csv files. From there it is easy(er) to manipulate them into tables for use in an empirical manuscript.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
MASS::write.matrix(pwcWVwiGP, sep = ",", file = "pwcWVwiGP.csv")
#this command can also be used to export other output
MASS::write.matrix(Diff_2way$ANOVA, sep = ",", file = "Diff_2way.csv") 
MASS::write.matrix(SimpleWave, sep = ",", file = "SimpleWave.csv")
MASS::write.matrix(SimpleCond, sep = ",", file = "SimpleCond.csv") 
```

#### Comparing our findings to Murrar and Brauer [-@murrar_entertainment-education_2018] 

In general, the results of our simulation mapped onto the findings. If you have access to the article I encourage you to examine it as you consider my observations. 

* The authors started their primary analyses of Experiment 1 with independent *t* tests comparing the Friends and Little Mosque conditions within each of the baseline, post1, and post2 waves. This is equivalent to our simple main effects of condition within wave that we conducted as follow-up to the significant interaction effect. It is not clear to me why they did not precede this with a mixed design ANOVA.
  - The results of the article are presented in their Table 1
  - Our results were comparable in that we found no attitude difference at baseline
  - Similar to the results in the article we found statistically significant differences (with comparable *p* values and effect sizes) at post1 and post2
* With two experiments (each with a number of associated hypotheses) in a single paper there were a large number of analyses conducted by the authors. I think they designed tables and figures that provided an efficient and clear review of the study design and their findings.
* This finding is exciting to me. Anti-racism education frequently encourages individuals to expose themselves to content authored/created by individuals from groups with marginalized identities. This finding supports that approach to prejudice reduction.

## Power in Mixed Design ANOVA

The package [*wp.rmanova*](https://webpower.psychstat.org/wiki/_media/grant/practical_statistica_interior_for_kindle.pdf) was designed for power analysis in repeated measures ANOVA.

Power analysis allows us to determine the probability of detecting an effect of a given size with a given level of confidence. Especially when we don't achieve significance, we may want to stop. 

In the *WebPower* package, we specify 6 of 7 interrelated elements; the package computes the missing element

* *n* = sample size (number of individuals in the whole study)
* *ng* = number of groups
* *nm* = number of repeated measurements (i.e., waves)
* *f* = Cohen's *f* (an effect size; we can use a conversion calculator); Cohen suggests that f values of 0.1, 0.25, and 0.4 represent small, medium, and large effect sizes, respectively
* *nscor* = the Greenhouse Geiser correction from our ouput; 1.0 means no correction was needed and is the package's default; < 1 means some correction was applied 
* *alpha* = is the probability of Type I error; we traditionally set this at .05 
* *power* = 1 - P(Type II error) we traditionally set this at .80 (so anything less is less than what we want)
* *type* = 0 is for between-subjects, 1 is for repeated measures, 2 is for interaction effect; in a mixed design ANOVA we will select "2" 

As in the prior lessons, we need to convert our effect size for the *interaction* to $f$ effect size (this is not the same as the *F* test). The *effectsize* package has a series of converters. We can use the *eta2_to_f()* function to translate the $\eta^{2}$ associated with the interaction effect to Cohen's *f*. 

```{r message=FALSE, warning = FALSE}
#interaction effect
effectsize::eta2_to_f(0.017) 
```
We can now retrieve information from our study (including the Cohen's *f* value we just calculated) and insert it into the script for the power analysis.
```{r message=FALSE, warning = FALSE }
WebPower::wp.rmanova(n=193, ng=2, nm=3, f = .1315, nscor = .99, alpha = .05, power = NULL, type = 2)
```
We are powered at .349 (we have a 35% of rejecting the null hypothesis, if it is true)

In reverse, setting *power* at .80 (the traditional value) and changing *n* to *NULL* yields a recommended sample size.  

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
WebPower::wp.rmanova(n=NULL, ng=2, nm=3, f = .1315, nscor = .99, alpha = .05, power = .80, type = 2)
```
Given our desire for strong power and our weak effect size, this power analysis suggests a sample size of 562 participants to detect a significant interaction effect.

## Practice Problems
  
The suggestions for homework differ in degree of complexity. I encourage you to start with a problem that feels "do-able" and then try at least one more problem that challenges you in some way.  At a minimum your data should allow for a 2 X 3 (or 3 X 2) design. At least one of the problems you work should have a statistically significant interaction effect that you work all the way through. 

Regardless, your choices should meet you where you are (e.g., in terms of your self-efficacy for statistics, your learning goals, and competing life demands). Whichever you choose, you will focus on these larger steps in one-way ANOVA, including:

* test the statistical assumptions
* conduct a two-way (minimally a 2x3), mixed design, ANOVA, including
  - omnibus test and effect size
  - report main and interaction effects
  - conduct follow-up testing of simple main effects
* write a results section to include a figure and tables

### Problem #1: Play around with this simulation.

Copy the script for the simulation and then change (at least) one thing in the simulation to see how it impacts the results. 

* If mixed design ANOVA is new to you, perhaps you just change the number in "set.seed(210813)" from 210813 to something else. Your results should parallel those obtained in the lecture, making it easier for you to check your work as you go.
* If you are interested in power, change the sample size to something larger or smaller.
* If you are interested in variability (i.e., the homogeneity of variance assumption), perhaps you change the standard deviations in a way that violates the assumption.

### Problem #2: Conduct a one-way ANOVA with a different dependent variable.

The Murrar et al. [-@murrar_entertainment-education_2018] article has three dependent variables (attitudes toward people who are Arab, attitudes toward people who are White, and the difference score). I analyzed the difference score. Select one of the other dependent variables. If you do not get a significant interaction, play around with the simulation (changing the sample size, standard deviations, or both) until you get a significant interaction effect.
  
### Problem #3: Try something entirely new.

Using data for which you have permission and access (e.g., IRB approved data you have collected or from your lab; data you simulate from a published article; data from an open science repository; data from other chapters in this OER), complete a mixed design ANOVA. Please have at least 3 levels for one predictor and at least 2 levels for the second predictor.

### Grading Rubric

Regardless which option(s) you chose, use the elements in the grading rubric to guide you through the practice.

|Assignment Component                    | Points Possible   | Points Earned|
|:-------------------------------------- |:----------------: |:------------:|
|1. Narrate the research vignette, describing the IV and DV. Miniminally, the data should allow the analysis of a 2 x 3 (or 3 X 2) design. At least one of the problems you work should have a significant interaction effect so that follow-up is required. | 5 |_____  |
|2. Simulate (or import) and format data               |      5            |_____  |           
|3. Evaluate statistical assumptions     |      5            |_____  |
|4. Conduct omnibus ANOVA (w effect size) |      5           | _____  |  
|5. Conduct one set of follow-up tests; narrate your choice| 5 |_____  |               
|6. Describe approach for managing Type I error |    5        |_____  |   
|7. APA style results with table(s) and figure  |    5        |_____  |       
|8 Explanation to grader                 |      5        |_____  |
|**Totals**                               |      40       |_____  |          

```{r include=FALSE}
sessionInfo()
```




